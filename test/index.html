<!DOCTYPE html>
<html lang="en">
<head>
  <title>DOM TEST</title>
  <meta charset="utf-8"/>
  <script src="../lib/domtemplate.js"></script>
  <script src="../lib/promise.js"></script>
  <script>
  var $ = function(id) { return document.getElementById(id); };
  console.log('start');
  </script>
</head>
<body>

<div id="ex1">${nested.value}</div>
<script>
new Templater().processNode('ex1', { nested:{ value:'pass 1' } });
console.assert('pass 1' === $('ex1').innerHTML, 'ex1 failed');
</script>

<div id="ex2">${document.createTextNode('pass 2')}</div>
<script>
new Templater().processNode('ex2');
console.assert("pass 2" === $('ex2').innerHTML, 'ex2 failed');
</script>

<img id="ex3" _src="${src}" onload="${handler}">
<script>
new Templater().processNode('ex3', {
  src: 'green.png',
  handler: function(ev) {
    console.assert($('ex3').src.indexOf('green.png') > 0, 'ex3 failed');
  }
});
</script>

<div id="ex4"><p if="${name !== null}">testing: ${name}</p></div>
<script>
new Templater().processNode('ex4', { name: 'pass 4' });
console.assert("<p>testing: pass 4</p>" === $('ex4').innerHTML, 'ex4 failed');
</script>

<div id="ex5"><p if="${name}">testing: ${name}</p></div>
<script>
new Templater().processNode('ex5', { });
console.assert('' === $('ex5').innerHTML, 'ex5 failed');
</script>

<div id="ex6"><p foreach="index in ${[ 1, 2, 3 ]}">${index}</p></div>
<script>
new Templater().processNode('ex6');
console.assert('<p>1</p><p>2</p><p>3</p>' === $('ex6').innerHTML, 'ex6 failed');
</script>

<div id="ex7"><loop foreach="index in ${[ 1, 2, 3 ]}">${index}</loop></div>
<script>
new Templater().processNode('ex7');
console.assert('123' === $('ex7').innerHTML, 'ex7 failed');
</script>

<div id="ex8"><p save="${element}">${name}</p></div>
<script>
var data = { name: 'pass 8' };
new Templater().processNode('ex8', data);
console.assert('pass 8' === data.element.innerHTML, 'ex8 failed');
</script>

<div id="ex9"><p id="pass9">${adjust(__element)}</p></div>
<script>
new Templater().processNode('ex9', {
  adjust: function(element) {
    console.assert('pass9' === element.id, 'ex9a failed');
    return 'pass 9b'
  }
});
console.assert('<p id="pass9">pass 9b</p>' === $('ex9').innerHTML, 'ex9b failed');
</script>

</body>
</html>
